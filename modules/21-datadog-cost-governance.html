<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Module 21: Datadog Cost Governance | Service Incident Analysis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            gray: {
              950: '#0a0a0f',
              900: '#111118',
              850: '#16161f',
              800: '#1e1e2a',
              700: '#2a2a3a',
              600: '#3a3a4d',
              400: '#8888a0',
              300: '#a0a0b8',
              200: '#c0c0d0',
              100: '#e0e0ea'
            }
          }
        }
      }
    };
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css?v=20260218">
  <script src="../js/auth.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    .info-box { border-left: 4px solid #3b82f6; background: rgba(59, 130, 246, 0.08); }
    .tip-box { border-left: 4px solid #eab308; background: rgba(234, 179, 8, 0.08); }
    .warning-box { border-left: 4px solid #ef4444; background: rgba(239, 68, 68, 0.08); }
    .success-box { border-left: 4px solid #22c55e; background: rgba(34, 197, 94, 0.08); }
    .sidebar-link.active { color: #60a5fa; border-left-color: #3b82f6; }
    .sidebar-link { transition: all 0.2s; }
    .sidebar-link:hover { color: #93c5fd; border-left-color: #60a5fa; }
    .sidebar-check.done { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; color: #22c55e; }
    pre[class*="language-"] { border-radius: 0.5rem; margin: 1rem 0; }
    @media (max-width: 1023px) {
      .sidebar-toggle-target { display: none; }
      .sidebar-toggle-target.open { display: block; }
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen" style="display:none">
  <header class="sticky top-0 z-50 bg-gray-950/90 backdrop-blur-sm border-b border-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="../index.html" class="flex items-center gap-2 text-gray-400 hover:text-blue-400 transition-colors text-sm font-medium">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          홈으로
        </a>
        <div class="hidden sm:block w-px h-6 bg-gray-800"></div>
        <div>
          <span class="text-blue-400 text-xs font-semibold tracking-wider uppercase">Module 21</span>
          <h1 class="text-lg sm:text-xl font-bold text-gray-100">Datadog Cost Governance</h1>
        </div>
      </div>
      <button id="sidebar-toggle" class="lg:hidden p-2 rounded-lg bg-gray-900 border border-gray-800 hover:border-gray-700 transition-colors" onclick="document.getElementById('sidebar').classList.toggle('open')">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 flex gap-8">
    <aside id="sidebar" class="sidebar-toggle-target lg:block w-64 flex-shrink-0">
      <nav class="lg:sticky lg:top-24 bg-gray-900 rounded-xl border border-gray-800 p-5">
        <h3 class="text-xs font-semibold uppercase tracking-wider text-gray-500 mb-4">목차</h3>
        <ul class="space-y-1">
          <li><a href="#section-1" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="section-1"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-section-1"></span>비용 구조 이해</a></li>
          <li><a href="#section-2" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="section-2"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-section-2"></span>샘플링 전략</a></li>
          <li><a href="#section-3" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="section-3"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-section-3"></span>카디널리티 제어</a></li>
          <li><a href="#section-4" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="section-4"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-section-4"></span>보존/파이프라인 정책</a></li>
          <li><a href="#section-5" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="section-5"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-section-5"></span>거버넌스 운영 모델</a></li>
          <li><a href="#quiz" class="sidebar-link flex items-center gap-2 px-3 py-2 text-sm text-gray-400 border-l-2 border-transparent rounded-r-md" data-section="quiz"><span class="sidebar-check w-4 h-4 rounded-full border border-gray-700 flex items-center justify-center text-xs" id="check-quiz"></span>퀴즈</a></li>
        </ul>
        <div class="mt-6 pt-4 border-t border-gray-800">
          <div class="flex items-center justify-between text-xs text-gray-500 mb-2"><span>진행률</span><span id="progress-percent">0%</span></div>
          <div class="w-full bg-gray-800 rounded-full h-1.5"><div id="progress-bar" class="bg-blue-500 h-1.5 rounded-full transition-all duration-500" style="width:0%"></div></div>
        </div>
      </nav>
    </aside>

    <main class="flex-1 min-w-0">
      <section id="section-1" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-blue-400 font-bold text-lg">1</span></div>
          <h2 class="text-2xl font-bold text-gray-100">Datadog 비용 구조 이해</h2>
        </div>
        <div class="space-y-6 text-gray-300 leading-relaxed">
          <p>Datadog 비용 최적화의 핵심은 "무엇이 비용을 만드는지"를 팀이 공통 언어로 이해하는 것입니다. 보통 로그 인덱싱, 고카디널리티 메트릭, 과도한 APM 수집이 상위 원인입니다.</p>
          <div class="bg-gray-900 border border-gray-800 rounded-xl p-5">
            <h3 class="font-semibold text-gray-100 mb-3">주요 비용 드라이버</h3>
            <ul class="space-y-2 text-sm">
              <li><strong class="text-gray-100">Logs:</strong> ingest volume + indexed volume + retention 기간</li>
              <li><strong class="text-gray-100">Metrics:</strong> custom metric 시계열 수 (태그 조합 영향)</li>
              <li><strong class="text-gray-100">APM:</strong> span ingest 비율과 서비스 수</li>
              <li><strong class="text-gray-100">RUM:</strong> 세션/이벤트 수집량</li>
            </ul>
          </div>
          <div class="warning-box rounded-lg p-5">
            <h3 class="font-semibold text-red-300 mb-2">흔한 실수</h3>
            <p class="text-sm">"데이터를 많이 남기면 안전하다"는 접근은 장기적으로 비용 폭탄이 됩니다. 장애 대응에 실질적으로 쓰는 데이터와 감사/컴플라이언스 데이터를 분리해 운영하세요.</p>
          </div>
        </div>
      </section>

      <section id="section-2" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-blue-400 font-bold text-lg">2</span></div>
          <h2 class="text-2xl font-bold text-gray-100">샘플링 전략: 정확도와 비용 균형</h2>
        </div>
        <div class="space-y-6 text-gray-300 leading-relaxed">
          <p>샘플링은 "무작정 줄이는 것"이 아니라 "문제 탐지 능력을 유지하면서 볼륨을 낮추는 것"입니다. 우선순위 기반 샘플링이 실무에서 가장 안정적입니다.</p>
          <div class="grid gap-4 sm:grid-cols-3">
            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
              <h3 class="text-sm font-semibold text-emerald-300 mb-2">Always Keep</h3>
              <p class="text-xs text-gray-400">5xx, timeout, p99 outlier trace</p>
            </div>
            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
              <h3 class="text-sm font-semibold text-cyan-300 mb-2">Adaptive</h3>
              <p class="text-xs text-gray-400">트래픽 급증 시 정상 트랜잭션 샘플 비율 자동 축소</p>
            </div>
            <div class="bg-gray-900 border border-gray-800 rounded-xl p-4">
              <h3 class="text-sm font-semibold text-amber-300 mb-2">Low Priority</h3>
              <p class="text-xs text-gray-400">정상 헬스체크/정적 경로 로그 축소</p>
            </div>
          </div>
          <div class="tip-box rounded-lg p-5">
            <h3 class="font-semibold text-amber-300 mb-2">실무 규칙</h3>
            <p class="text-sm">"오류 데이터는 100%", "정상 데이터는 서비스 중요도에 따라 1~20%"로 시작한 뒤, 탐지율 저하가 없는지 월별로 검증하세요.</p>
          </div>
        </div>
      </section>

      <section id="section-3" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-blue-400 font-bold text-lg">3</span></div>
          <h2 class="text-2xl font-bold text-gray-100">카디널리티 제어</h2>
        </div>
        <div class="space-y-6 text-gray-300 leading-relaxed">
          <p>카디널리티 폭증은 커스텀 메트릭 비용을 급격히 증가시킵니다. user_id, session_id, request_id 같은 고유값 태그는 메트릭에 직접 붙이지 않는 것이 원칙입니다.</p>
          <pre><code class="language-text">좋은 태그: env, service, region, endpoint_group
나쁜 태그: user_id, email, request_id, trace_id</code></pre>
          <div class="info-box rounded-lg p-5">
            <h3 class="font-semibold text-blue-300 mb-2">대안 패턴</h3>
            <ul class="space-y-1 text-sm">
              <li>고유 ID는 로그/트레이스에만 유지하고 메트릭에서는 제외</li>
              <li>endpoint를 템플릿 경로(`/users/:id`)로 정규화</li>
              <li>팀 단위 태그 정책을 lint/CI로 강제</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="section-4" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-blue-400 font-bold text-lg">4</span></div>
          <h2 class="text-2xl font-bold text-gray-100">보존 기간과 파이프라인 정책</h2>
        </div>
        <div class="space-y-6 text-gray-300 leading-relaxed">
          <p>모든 데이터를 같은 기간 보관할 필요는 없습니다. 운영 데이터는 짧게, 감사/보안 데이터는 길게 보관하는 계층형 전략이 필요합니다.</p>
          <div class="bg-gray-900 border border-gray-800 rounded-xl p-5">
            <h3 class="font-semibold text-gray-100 mb-3">권장 분류 예시</h3>
            <ul class="space-y-2 text-sm">
              <li><strong class="text-gray-100">Hot (7~15일):</strong> 온콜 대응 핵심 로그/트레이스</li>
              <li><strong class="text-gray-100">Warm (30~60일):</strong> 장애 트렌드/성능 분석용</li>
              <li><strong class="text-gray-100">Archive (90일+):</strong> 규정 준수/감사용</li>
            </ul>
          </div>
          <div class="success-box rounded-lg p-5">
            <h3 class="font-semibold text-emerald-300 mb-2">Pipeline 우선순위</h3>
            <p class="text-sm">드랍/샘플링 룰은 ingest 직후 적용해야 비용 절감 효과가 큽니다. 인덱스된 후 제거하면 이미 비용이 발생한 뒤입니다.</p>
          </div>
        </div>
      </section>

      <section id="section-5" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"><span class="text-blue-400 font-bold text-lg">5</span></div>
          <h2 class="text-2xl font-bold text-gray-100">거버넌스 운영 모델</h2>
        </div>
        <div class="space-y-6 text-gray-300 leading-relaxed">
          <p>비용 최적화는 일회성 캠페인이 아니라 운영 프로세스입니다. 팀별 예산/소유권이 없으면 1~2개월 내 원복됩니다.</p>
          <div class="bg-gray-900 border border-gray-800 rounded-xl p-5">
            <h3 class="font-semibold text-gray-100 mb-3">월간 Cost Governance 회의 안건</h3>
            <pre><code class="language-text">1) Top 10 cost drivers (logs, metrics, apm)
2) 신규 서비스 태그/샘플링 정책 준수율
3) 절감 액션 진행률 (owner, due date)
4) 다음 달 예산 리스크</code></pre>
          </div>
          <div class="info-box rounded-lg p-5">
            <h3 class="font-semibold text-blue-300 mb-2">권장 KPI</h3>
            <ul class="space-y-1 text-sm">
              <li>서비스별 Datadog 단가(월/서비스)</li>
              <li>고카디널리티 태그 위반 건수</li>
              <li>오류 탐지율 유지율(비용 절감 전후)</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="quiz" class="mb-16">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center"><svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
          <h2 class="text-2xl font-bold text-gray-100">퀴즈</h2>
        </div>
        <p class="text-gray-400 text-sm mb-6">Datadog 비용 거버넌스 핵심을 5문제로 점검하세요.</p>
        <div id="quiz-container"></div>
      </section>

      <div class="border-t border-gray-800 pt-8 mt-16">
        <div class="flex justify-center mb-8">
          <button id="complete-btn" onclick="handleComplete()" class="px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-xl transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-950">학습 완료</button>
        </div>
        <div class="flex items-center justify-between">
          <a href="20-datadog-slo-operations.html" class="flex items-center gap-2 text-gray-400 hover:text-blue-400 transition-colors text-sm font-medium"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>Module 20: Datadog SLO Operations</a>
          <a href="22-lab-monitor-tuning.html" class="flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors text-sm font-medium">Lab 13: Monitor Tuning<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></a>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="../js/progress.js"></script>
  <script src="../js/quiz.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var questions = [
        {
          type: 'choice',
          question: 'Datadog 비용 상승의 대표 원인으로 가장 적절한 것은?',
          options: ['태그 표준화', '고카디널리티 태그 남용', '로그 보존 기간 단축', '샘플링 적용'],
          answer: 1,
          explanation: '고유값 태그는 시계열 수를 폭증시켜 custom metrics 비용을 빠르게 증가시킵니다.'
        },
        {
          type: 'choice',
          question: '메트릭 태그로 부적절한 것은?',
          options: ['env:prod', 'region:ap-northeast-2', 'service:checkout', 'user_id:928374'],
          answer: 3,
          explanation: 'user_id 같은 고유값은 카디널리티를 크게 늘려 비용과 관리 난이도를 올립니다.'
        },
        {
          type: 'choice',
          question: '샘플링 정책에서 일반적으로 옳은 전략은?',
          options: ['오류 데이터부터 우선 축소', '정상 트래픽 중심으로 샘플 축소, 오류는 최대 보존', '모든 서비스 동일 1% 샘플', '샘플링은 비용과 무관'],
          answer: 1,
          explanation: '문제 분석 신호를 유지하려면 오류 이벤트는 가능한 보존하고 정상 대량 트래픽을 줄이는 것이 좋습니다.'
        },
        {
          type: 'choice',
          question: '데이터 보존 정책의 권장 방향은?',
          options: ['모든 로그를 동일 기간 보관', '운영/감사 데이터를 분리해 계층형 보관', '보관기간은 비용과 무관', '실시간 로그만 보관'],
          answer: 1,
          explanation: '용도별 보존 계층화가 비용과 분석 유용성의 균형을 만듭니다.'
        },
        {
          type: 'short',
          question: '비용과 분석 복잡도를 급격히 올리는 태그 특성을 무엇이라 부르나요? (영문 11자)',
          answer: 'cardinality',
          evaluator: {
            mode: 'keyword',
            keywords: ['cardinality', '카디널리티'],
            minMatch: 1
          },
          explanation: '고카디널리티(cardinality) 제어가 Datadog 비용 거버넌스의 핵심입니다.'
        }
      ];

      if (typeof QuizEngine !== 'undefined') {
        QuizEngine.init('quiz-container', questions, 'module21');
      }

      if (typeof ProgressTracker !== 'undefined' && ProgressTracker.isComplete('module21')) {
        markButtonComplete();
      }

      initSidebar();
    });

    function handleComplete() {
      if (typeof ProgressTracker === 'undefined') {
        alert('진도 저장 기능을 찾을 수 없습니다. 페이지를 새로고침해 주세요.');
        return;
      }

      var completionResult = ProgressTracker.markComplete('module21');
      var isSuccess = completionResult !== false && (!completionResult || completionResult.success !== false);
      if (isSuccess) {
        markButtonComplete();
        return;
      }

      var message = completionResult && completionResult.message
        ? completionResult.message
        : '완료 처리에 실패했습니다. 잠시 후 다시 시도해 주세요.';
      alert(message);
    }

    function markButtonComplete() {
      var btn = document.getElementById('complete-btn');
      if (btn) {
        btn.classList.remove('bg-blue-600', 'hover:bg-blue-500');
        btn.classList.add('bg-emerald-600', 'hover:bg-emerald-500', 'completed');
        btn.innerHTML = '<svg class="w-5 h-5 inline mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>학습 완료됨';
      }
    }

    function initSidebar() {
      var sections = document.querySelectorAll('section[id]');
      var sidebarLinks = document.querySelectorAll('.sidebar-link');
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            var id = entry.target.getAttribute('id');
            sidebarLinks.forEach(function(link) {
              link.classList.remove('active');
              if (link.getAttribute('data-section') === id) {
                link.classList.add('active');
              }
            });

            if (id.indexOf('section-') === 0) {
              var check = document.getElementById('check-' + id);
              if (check && !check.classList.contains('done')) {
                check.classList.add('done');
                check.innerHTML = '&#10003;';
              }
            }
            if (id === 'quiz') {
              var quizCheck = document.getElementById('check-quiz');
              if (quizCheck && !quizCheck.classList.contains('done')) {
                quizCheck.classList.add('done');
                quizCheck.innerHTML = '&#10003;';
              }
            }
            updateProgress();
          }
        });
      }, { rootMargin: '-20% 0px -60% 0px' });

      sections.forEach(function(section) {
        observer.observe(section);
      });

      sidebarLinks.forEach(function(link) {
        link.addEventListener('click', function() {
          var sidebar = document.getElementById('sidebar');
          if (window.innerWidth < 1024 && sidebar) {
            sidebar.classList.remove('open');
          }
        });
      });
    }

    function updateProgress() {
      var totalSections = 6;
      var completed = 0;
      for (var i = 1; i <= 5; i++) {
        var check = document.getElementById('check-section-' + i);
        if (check && check.classList.contains('done')) {
          completed++;
        }
      }
      var quizCheck = document.getElementById('check-quiz');
      if (quizCheck && quizCheck.classList.contains('done')) {
        completed++;
      }
      var percent = Math.round((completed / totalSections) * 100);
      var bar = document.getElementById('progress-bar');
      var percentText = document.getElementById('progress-percent');
      if (bar) bar.style.width = percent + '%';
      if (percentText) percentText.textContent = percent + '%';
    }
  </script>
</body>
</html>
